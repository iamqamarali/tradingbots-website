<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Account Details - Trading Bot Manager</title>
    <link rel="stylesheet" href="/static/style.css">
    <link rel="stylesheet" href="/static/accounts.css">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="app-container">
        {% include 'includes/sidebar.html' %}

        <!-- Main Content -->
        <main class="main-content account-detail-page-content">
            <!-- Header -->
            <header class="page-header">
                <div class="header-left">
                    <a href="/accounts" class="back-btn">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="19" y1="12" x2="5" y2="12"></line>
                            <polyline points="12 19 5 12 12 5"></polyline>
                        </svg>
                    </a>
                    <div class="account-header-info">
                        <div class="account-title">
                            <h1 id="accountName">Loading...</h1>
                            <span class="testnet-badge" id="testnetBadge" style="display: none;">TESTNET</span>
                        </div>
                        <span class="account-key" id="accountKey">API Key: ...</span>
                    </div>
                </div>
                <div class="header-actions">
                    <button class="action-btn trade-btn" id="newTradeBtn">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/>
                        </svg>
                        <span>New Trade</span>
                    </button>
                    <a href="/accounts/{{ account_id }}/stats" class="action-btn stats-btn">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M18 20V10"/>
                            <path d="M12 20V4"/>
                            <path d="M6 20v-6"/>
                        </svg>
                        <span>Stats</span>
                    </a>
                    <button class="action-btn sync-btn" id="syncBtn">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="23 4 23 10 17 10"/>
                            <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/>
                        </svg>
                        <span>Sync Trades</span>
                    </button>
                    <button class="action-btn close-all-btn" id="closeAllBtn">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <line x1="15" y1="9" x2="9" y2="15"/>
                            <line x1="9" y1="9" x2="15" y2="15"/>
                        </svg>
                        <span>Close All</span>
                    </button>
                </div>
            </header>

        <!-- Attached Bots Section -->
        <section class="attached-bots-section" id="attachedBotsSection" style="display: none;">
            <div class="section-header">
                <h2>
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/>
                    </svg>
                    Attached Bots
                </h2>
                <span class="bots-count" id="botsCount">0 bots</span>
            </div>
            <div class="attached-bots-grid" id="attachedBotsGrid">
                <!-- Bot cards will be inserted here -->
            </div>
        </section>

        <!-- Open Positions & Orders Section -->
        <section class="positions-orders-section">
            <div class="section-header">
                <div class="section-tabs">
                    <button class="section-tab active" data-tab="positions">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/>
                        </svg>
                        Open Positions
                        <span class="tab-count" id="positionsCount">0</span>
                    </button>
                    <button class="section-tab" data-tab="orders">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                            <polyline points="14 2 14 8 20 8"/>
                            <line x1="16" y1="13" x2="8" y2="13"/>
                            <line x1="16" y1="17" x2="8" y2="17"/>
                        </svg>
                        Open Orders
                        <span class="tab-count" id="ordersCount">0</span>
                    </button>
                </div>
                <button class="refresh-btn" id="refreshPositionsBtn">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="23 4 23 10 17 10"/>
                        <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/>
                    </svg>
                    Refresh
                </button>
            </div>

            <!-- Positions Tab Content -->
            <div class="tab-content active" id="positionsTab">
                <div class="positions-container">
                    <div class="positions-table-wrapper">
                        <table class="positions-table" id="positionsTable">
                            <thead>
                                <tr>
                                    <th>Symbol</th>
                                    <th>Side</th>
                                    <th>Size ($)</th>
                                    <th>Entry Price</th>
                                    <th>Mark Price</th>
                                    <th>SL / TP</th>
                                    <th>Unrealized PnL</th>
                                    <th>Leverage</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="positionsBody">
                                <!-- Positions will be inserted here -->
                            </tbody>
                        </table>
                    </div>

                    <div class="loading-state" id="positionsLoading" style="display: none;">
                        <div class="spinner"></div>
                        <p>Loading positions...</p>
                    </div>

                    <div class="empty-positions" id="emptyPositions" style="display: none;">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <circle cx="12" cy="12" r="10"/>
                            <path d="M8 12h8"/>
                        </svg>
                        <p>No open positions</p>
                    </div>
                </div>
            </div>

            <!-- Orders Tab Content -->
            <div class="tab-content" id="ordersTab">
                <div class="orders-container">
                    <div class="orders-table-wrapper">
                        <table class="orders-table" id="ordersTable">
                            <thead>
                                <tr>
                                    <th>Time</th>
                                    <th>Symbol</th>
                                    <th>Type</th>
                                    <th>Side</th>
                                    <th>Quantity</th>
                                    <th>Price</th>
                                    <th>Stop Price</th>
                                    <th>Reduce Only</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="ordersBody">
                                <!-- Orders will be inserted here -->
                            </tbody>
                        </table>
                    </div>

                    <div class="loading-state" id="ordersLoading" style="display: none;">
                        <div class="spinner"></div>
                        <p>Loading orders...</p>
                    </div>

                    <div class="empty-orders" id="emptyOrders" style="display: none;">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <circle cx="12" cy="12" r="10"/>
                            <path d="M8 12h8"/>
                        </svg>
                        <p>No open orders</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Recent Trades Section -->
        <section class="trades-section">
            <div class="section-header">
                <h2>
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/>
                        <polyline points="12 6 12 12 16 14"/>
                    </svg>
                    Synced Trades
                </h2>
                <div class="section-actions">
                    <button class="refresh-btn" id="refreshTradesBtn">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="23 4 23 10 17 10"/>
                            <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/>
                        </svg>
                        Refresh
                    </button>
                    <button class="action-btn sync-btn" id="syncTradesBtn">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="23 4 23 10 17 10"/>
                            <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/>
                        </svg>
                        <span>Sync Trades</span>
                    </button>
                </div>
            </div>
            
            <div class="trades-container">
                <div class="trades-table-wrapper">
                    <table class="trades-table" id="tradesTable">
                        <thead>
                            <tr>
                                <th>Time</th>
                                <th>Symbol</th>
                                <th>Side</th>
                                <th>Size</th>
                                <th>Price</th>
                                <th>PnL</th>
                                <th>Fee</th>
                            </tr>
                        </thead>
                        <tbody id="tradesBody">
                            <!-- Trades will be inserted here -->
                        </tbody>
                    </table>
                </div>
                
                <div class="loading-state" id="tradesLoading" style="display: none;">
                    <div class="spinner"></div>
                    <p>Loading trades...</p>
                </div>
                
                <div class="empty-trades" id="emptyTrades" style="display: none;">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                        <circle cx="12" cy="12" r="10"/>
                        <polyline points="12 6 12 12 16 14"/>
                    </svg>
                    <p>No trades synced yet</p>
                    <button class="btn-secondary" onclick="document.getElementById('syncBtn').click()">Sync Trades Now</button>
                </div>
            </div>
        </section>
        </main>
    </div>

    <!-- Close All Confirmation Modal -->
    <div class="modal-overlay" id="closeAllModal">
        <div class="modal modal-small">
            <div class="modal-header">
                <h3>Close All Positions</h3>
                <button class="modal-close" id="closeCloseAllModal">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="warning-icon danger">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
                        <line x1="12" y1="9" x2="12" y2="13"/>
                        <line x1="12" y1="17" x2="12.01" y2="17"/>
                    </svg>
                </div>
                <p><strong>Warning:</strong> This will close ALL open positions at market price.</p>
                <p class="warning-text">This action cannot be undone. Make sure you understand the implications.</p>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" id="cancelCloseAllBtn">Cancel</button>
                <button class="btn-danger" id="confirmCloseAllBtn">
                    <span class="btn-text">Close All Positions</span>
                    <span class="btn-loading" style="display: none;">
                        <div class="btn-spinner"></div>
                        Closing...
                    </span>
                </button>
            </div>
        </div>
    </div>

    <!-- Close Position Modal -->
    <div class="modal-overlay" id="closePositionModal">
        <div class="modal modal-small">
            <div class="modal-header">
                <h3>Close Position</h3>
                <button class="modal-close" id="closePositionModalBtn">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="position-info">
                    <span class="position-symbol" id="closePositionSymbol">BTCUSDT</span>
                    <span class="position-side" id="closePositionSide">LONG</span>
                </div>
                <div class="position-details">
                    <div class="detail-row">
                        <span>Current Size:</span>
                        <span id="closePositionSize">0.00</span>
                    </div>
                    <div class="detail-row">
                        <span>Unrealized PnL:</span>
                        <span id="closePositionPnl">$0.00</span>
                    </div>
                </div>
                <div class="close-amount-section">
                    <label>Close Amount</label>
                    <div class="percentage-buttons">
                        <button class="pct-btn" data-pct="25">25%</button>
                        <button class="pct-btn" data-pct="50">50%</button>
                        <button class="pct-btn" data-pct="75">75%</button>
                        <button class="pct-btn active" data-pct="100">100%</button>
                    </div>
                    <div class="slider-container">
                        <input type="range" id="closePercentSlider" min="1" max="100" value="100" class="percentage-slider">
                        <div class="slider-value"><span id="closePercentValue">100</span>%</div>
                    </div>
                    <div class="usdc-input-section">
                        <label for="closeUsdc">Or enter USDC amount:</label>
                        <input type="number" id="closeUsdc" step="any" placeholder="Enter USDC...">
                    </div>
                    <div class="close-quantity">
                        <span>Quantity to close:</span>
                        <span id="closeQuantityValue">0.00</span>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" id="cancelClosePositionBtn">Cancel</button>
                <button class="btn-danger" id="confirmClosePositionBtn">
                    <span class="btn-text">Close Position</span>
                    <span class="btn-loading" style="display: none;">
                        <div class="btn-spinner"></div>
                        Closing...
                    </span>
                </button>
            </div>
        </div>
    </div>

    <!-- Edit Stop Loss Modal -->
    <div class="modal-overlay" id="editStopLossModal">
        <div class="modal modal-small">
            <div class="modal-header">
                <h3>Edit Stop Loss</h3>
                <button class="modal-close" id="closeEditStopLossModal">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="position-info">
                    <span class="position-symbol" id="slSymbol">BTCUSDT</span>
                    <span class="position-side" id="slSide">LONG</span>
                </div>
                <div class="position-details">
                    <div class="detail-row">
                        <span>Entry Price:</span>
                        <span id="slEntryPrice">$0.00</span>
                    </div>
                    <div class="detail-row">
                        <span>Mark Price:</span>
                        <span id="slMarkPrice">$0.00</span>
                    </div>
                    <div class="detail-row">
                        <span>Position Size:</span>
                        <span id="slQuantity">0.00</span>
                    </div>
                    <div class="detail-row">
                        <span>Current Stop Loss:</span>
                        <span id="slCurrentStop">None</span>
                    </div>
                </div>
                <div class="form-group">
                    <label for="newStopPrice">New Stop Loss Price</label>
                    <input type="number" id="newStopPrice" step="0.01" placeholder="Enter stop price...">
                    <div class="stop-loss-hint" id="slHint">
                        <!-- Hint will be shown here -->
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" id="cancelEditStopLossBtn">Cancel</button>
                <button class="btn-secondary" id="removeStopLossBtn" style="display: none;">
                    Remove SL
                </button>
                <button class="btn-primary" id="confirmEditStopLossBtn">
                    <span class="btn-text">Set Stop Loss</span>
                    <span class="btn-loading" style="display: none;">
                        <div class="btn-spinner"></div>
                        Updating...
                    </span>
                </button>
            </div>
        </div>
    </div>

    <!-- Edit Take Profit Modal -->
    <div class="modal-overlay" id="editTakeProfitModal">
        <div class="modal modal-small">
            <div class="modal-header">
                <h3>Edit Take Profit</h3>
                <button class="modal-close" id="closeEditTakeProfitModal">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="position-info">
                    <span class="position-symbol" id="tpSymbol">BTCUSDT</span>
                    <span class="position-side" id="tpSide">LONG</span>
                </div>
                <div class="position-details">
                    <div class="detail-row">
                        <span>Entry Price:</span>
                        <span id="tpEntryPrice">$0.00</span>
                    </div>
                    <div class="detail-row">
                        <span>Mark Price:</span>
                        <span id="tpMarkPrice">$0.00</span>
                    </div>
                    <div class="detail-row">
                        <span>Current Take Profit:</span>
                        <span id="tpCurrentTP">None</span>
                    </div>
                </div>
                <div class="form-group">
                    <label for="newTakeProfitPrice">New Take Profit Price</label>
                    <input type="number" id="newTakeProfitPrice" step="0.01" placeholder="Enter take profit price...">
                    <div class="take-profit-hint" id="tpHint">
                        <!-- Hint will be shown here -->
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" id="cancelEditTakeProfitBtn">Cancel</button>
                <button class="btn-secondary" id="removeTakeProfitBtn" style="display: none;">
                    Remove TP
                </button>
                <button class="btn-primary" id="confirmEditTakeProfitBtn">
                    <span class="btn-text">Set Take Profit</span>
                    <span class="btn-loading" style="display: none;">
                        <div class="btn-spinner"></div>
                        Updating...
                    </span>
                </button>
            </div>
        </div>
    </div>

    <!-- Add to Position Modal -->
    <div class="modal-overlay" id="addToPositionModal">
        <div class="modal modal-small">
            <div class="modal-header">
                <h3>Add to Position</h3>
                <button class="modal-close" id="closeAddToPositionModal">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="position-info">
                    <span class="position-symbol" id="addPosSymbol">BTCUSDT</span>
                    <span class="position-side" id="addPosSide">LONG</span>
                </div>
                <div class="position-details">
                    <div class="detail-row">
                        <span>Current Size:</span>
                        <span id="addPosCurrentSize">0.00</span>
                    </div>
                    <div class="detail-row">
                        <span>Entry Price:</span>
                        <span id="addPosEntryPrice">$0.00</span>
                    </div>
                    <div class="detail-row">
                        <span>Mark Price:</span>
                        <span id="addPosMarkPrice">$0.00</span>
                    </div>
                    <div class="detail-row">
                        <span>Leverage:</span>
                        <span id="addPosLeverage">1x</span>
                    </div>
                </div>
                <div class="available-margin-info">
                    <div class="margin-row">
                        <span>Available Balance:</span>
                        <span id="addPosAvailBalance">$0.00</span>
                    </div>
                    <div class="margin-row highlight">
                        <span>Max You Can Add:</span>
                        <span id="addPosMaxAdd">$0.00</span>
                    </div>
                </div>
                <div class="form-group">
                    <label for="addPosUsdc">Size to Add (USDC)</label>
                    <input type="number" id="addPosUsdc" step="any" placeholder="Enter USDC amount...">
                    <div class="add-pos-quick-btns">
                        <button type="button" class="quick-btn" data-pct="25">25%</button>
                        <button type="button" class="quick-btn" data-pct="50">50%</button>
                        <button type="button" class="quick-btn" data-pct="75">75%</button>
                        <button type="button" class="quick-btn" data-pct="100">Max</button>
                    </div>
                    <div class="calculated-qty">
                        Quantity: <span id="addPosCalcQty">0.00</span>
                    </div>
                    <div class="add-pos-hint">
                        This will place a market order to increase your position size
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" id="cancelAddToPositionBtn">Cancel</button>
                <button class="btn-primary" id="confirmAddToPositionBtn">
                    <span class="btn-text">Add to Position</span>
                    <span class="btn-loading" style="display: none;">
                        <div class="btn-spinner"></div>
                        Adding...
                    </span>
                </button>
            </div>
        </div>
    </div>

    <!-- Sync Progress Modal -->
    <div class="modal-overlay" id="syncModal">
        <div class="modal modal-small">
            <div class="modal-body sync-progress">
                <div class="sync-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="23 4 23 10 17 10"/>
                        <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/>
                    </svg>
                </div>
                <h3>Syncing Trades</h3>
                <p id="syncStatus">Fetching trades from Binance...</p>
                <div class="progress-bar">
                    <div class="progress-fill" id="syncProgress"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- New Trade Modal -->
    <div class="modal-overlay" id="newTradeModal">
        <div class="modal trade-modal">
            <div class="modal-header">
                <h3>New Trade</h3>
                <button class="modal-close" id="closeTradeModal">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body trade-modal-body">
                <!-- Symbol Selector -->
                <div class="trade-symbol-selector">
                    <label>Symbol</label>
                    <select id="tradeSymbol" class="trade-select">
                        <option value="SOLUSDC">SOL/USDC</option>
                        <option value="ETHUSDC">ETH/USDC</option>
                    </select>
                </div>

                <!-- Margin & Leverage Row -->
                <div class="trade-settings-row">
                    <div class="trade-toggle-group">
                        <button class="trade-toggle active" data-margin="CROSSED" id="marginCross">Cross</button>
                        <button class="trade-toggle" data-margin="ISOLATED" id="marginIsolated">Isolated</button>
                    </div>
                    <div class="leverage-selector">
                        <button class="leverage-btn" id="leverageBtn">
                            <span id="leverageValue">5</span>x
                        </button>
                    </div>
                </div>

                <!-- Order Type Tabs -->
                <div class="trade-order-tabs">
                    <button class="order-tab active" data-type="LIMIT">Limit</button>
                    <button class="order-tab" data-type="MARKET">Market</button>
                    <button class="order-tab" data-type="STOP">Stop Limit</button>
                </div>

                <!-- Price Input (for Limit/Stop orders) -->
                <div class="trade-input-group" id="priceInputGroup">
                    <label>Price</label>
                    <div class="trade-input-wrapper">
                        <input type="number" id="tradePrice" placeholder="0.00" step="0.01">
                        <span class="input-suffix">USDC</span>
                    </div>
                </div>

                <!-- Stop Price Input (for Stop Limit orders) -->
                <div class="trade-input-group" id="stopPriceInputGroup" style="display: none;">
                    <label>Stop Price</label>
                    <div class="trade-input-wrapper">
                        <input type="number" id="tradeStopPrice" placeholder="0.00" step="0.01">
                        <span class="input-suffix">USDC</span>
                    </div>
                </div>

                <!-- Size Input -->
                <div class="trade-input-group">
                    <label>Size</label>
                    <div class="trade-input-wrapper">
                        <input type="number" id="tradeSize" placeholder="0.00" step="0.001">
                        <span class="input-suffix">USDC</span>
                    </div>
                </div>

                <!-- Size Percentage Slider -->
                <div class="trade-slider-group">
                    <input type="range" id="tradeSizeSlider" min="0" max="100" value="0" step="25">
                    <div class="slider-labels">
                        <span data-value="0">0%</span>
                        <span data-value="25">25%</span>
                        <span data-value="50">50%</span>
                        <span data-value="75">75%</span>
                        <span data-value="100">100%</span>
                    </div>
                </div>

                <!-- Options Row -->
                <div class="trade-options-row">
                    <label class="trade-checkbox">
                        <input type="checkbox" id="tradeTpSl">
                        <span class="checkmark"></span>
                        TP/SL
                    </label>
                    <label class="trade-checkbox">
                        <input type="checkbox" id="tradeReduceOnly">
                        <span class="checkmark"></span>
                        Reduce-Only
                    </label>
                    <div class="tif-selector">
                        <span class="tif-label">TIF</span>
                        <select id="tradeTif" class="tif-select">
                            <option value="GTC">GTC</option>
                            <option value="IOC">IOC</option>
                            <option value="FOK">FOK</option>
                        </select>
                    </div>
                </div>

                <!-- TP/SL Inputs (hidden by default) -->
                <div class="trade-tpsl-group" id="tradeTpSlGroup" style="display: none;">
                    <div class="trade-input-group">
                        <label>Take Profit</label>
                        <div class="trade-input-wrapper">
                            <input type="number" id="tradeTpPrice" placeholder="0.00" step="0.01">
                            <span class="input-suffix">USDC</span>
                        </div>
                    </div>
                    <div class="trade-input-group">
                        <label>Stop Loss</label>
                        <div class="trade-input-wrapper">
                            <input type="number" id="tradeSlPrice" placeholder="0.00" step="0.01">
                            <span class="input-suffix">USDC</span>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="trade-buttons">
                    <button class="trade-btn-long" id="tradeBuyBtn">
                        <span class="btn-text">Buy/Long</span>
                        <span class="btn-loading" style="display: none;">
                            <svg class="spinner-icon" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="3" fill="none" stroke-dasharray="31.4 31.4" stroke-linecap="round"><animateTransform attributeName="transform" type="rotate" from="0 12 12" to="360 12 12" dur="1s" repeatCount="indefinite"/></circle></svg>
                        </span>
                    </button>
                    <button class="trade-btn-short" id="tradeSellBtn">
                        <span class="btn-text">Sell/Short</span>
                        <span class="btn-loading" style="display: none;">
                            <svg class="spinner-icon" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="3" fill="none" stroke-dasharray="31.4 31.4" stroke-linecap="round"><animateTransform attributeName="transform" type="rotate" from="0 12 12" to="360 12 12" dur="1s" repeatCount="indefinite"/></circle></svg>
                        </span>
                    </button>
                </div>

                <!-- Trade Info -->
                <div class="trade-info-row">
                    <div class="trade-info-item">
                        <span class="info-label">Available</span>
                        <span class="info-value" id="tradeAvailable">0.00 USDC</span>
                    </div>
                    <div class="trade-info-item">
                        <span class="info-label">Max Position</span>
                        <span class="info-value highlight" id="tradeMax">0.00 USDC</span>
                    </div>
                    <div class="trade-info-item">
                        <span class="info-label">Cost</span>
                        <span class="info-value" id="tradeCost">0.00 USDC</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Leverage Slider Modal -->
    <div class="modal-overlay" id="leverageModal">
        <div class="modal modal-small leverage-modal">
            <div class="modal-header">
                <h3>Adjust Leverage</h3>
                <button class="modal-close" id="closeLeverageModal">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="leverage-display">
                    <span id="leverageDisplayValue">5</span>x
                </div>
                <input type="range" id="leverageSlider" min="1" max="125" value="5" class="leverage-slider">
                <div class="leverage-labels">
                    <span>1x</span>
                    <span>25x</span>
                    <span>50x</span>
                    <span>75x</span>
                    <span>100x</span>
                    <span>125x</span>
                </div>
                <div class="leverage-warning">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
                        <line x1="12" y1="9" x2="12" y2="13"/>
                        <line x1="12" y1="17" x2="12.01" y2="17"/>
                    </svg>
                    <span>Higher leverage = Higher risk of liquidation</span>
                </div>
                <button class="btn-primary" id="confirmLeverageBtn">Confirm</button>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <script>
        // Pass account ID to JavaScript
        const ACCOUNT_ID = {{ account_id }};
    </script>
    <script src="/static/accounts.js"></script>
    <script>
        // User dropdown toggle
        const userAvatarBtn = document.getElementById('userAvatarBtn');
        const userDropdown = document.getElementById('userDropdown');

        if (userAvatarBtn && userDropdown) {
            userAvatarBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                userDropdown.classList.toggle('active');
            });

            document.addEventListener('click', (e) => {
                if (!userDropdown.contains(e.target) && !userAvatarBtn.contains(e.target)) {
                    userDropdown.classList.remove('active');
                }
            });
        }

        // Mobile menu toggle
        const mobileMenuBtn = document.getElementById('mobileMenuBtn');
        const sidebar = document.querySelector('.sidebar');
        const mobileOverlay = document.getElementById('mobileOverlay');

        if (mobileMenuBtn && sidebar && mobileOverlay) {
            mobileMenuBtn.addEventListener('click', () => {
                sidebar.classList.toggle('open');
                mobileOverlay.classList.toggle('active');
            });

            mobileOverlay.addEventListener('click', () => {
                sidebar.classList.remove('open');
                mobileOverlay.classList.remove('active');
            });
        }
    </script>
</body>
</html>

