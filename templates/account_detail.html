<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Account Details - Trading Bot Manager</title>
    <link rel="stylesheet" href="/static/style.css">
    <link rel="stylesheet" href="/static/accounts.css">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="app-container">
        {% include 'includes/sidebar.html' %}

        <!-- Main Content -->
        <main class="main-content account-detail-page-content">
            <!-- Header -->
            <header class="page-header">
                <div class="header-left">
                    <a href="/accounts" class="back-btn">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="19" y1="12" x2="5" y2="12"></line>
                            <polyline points="12 19 5 12 12 5"></polyline>
                        </svg>
                    </a>
                    <div class="account-header-info">
                        <div class="account-title">
                            <h1 id="accountName">Loading...</h1>
                            <span class="testnet-badge" id="testnetBadge" style="display: none;">TESTNET</span>
                        </div>
                        <span class="account-key" id="accountKey">API Key: ...</span>
                    </div>
                </div>
                <div class="header-actions">
                    <button class="action-btn trade-btn" id="newTradeBtn">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/>
                        </svg>
                        <span>New Trade</span>
                    </button>
                    <a href="/accounts/{{ account_id }}/stats" class="action-btn stats-btn">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M18 20V10"/>
                            <path d="M12 20V4"/>
                            <path d="M6 20v-6"/>
                        </svg>
                        <span>Stats</span>
                    </a>
                    <button class="action-btn sync-btn" id="syncBtn">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="23 4 23 10 17 10"/>
                            <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/>
                        </svg>
                        <span>Sync Trades</span>
                    </button>
                    <button class="action-btn close-all-btn" id="closeAllBtn">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <line x1="15" y1="9" x2="9" y2="15"/>
                            <line x1="9" y1="9" x2="15" y2="15"/>
                        </svg>
                        <span>Close All</span>
                    </button>
                </div>
            </header>

        <!-- Attached Bots Section -->
        <section class="attached-bots-section" id="attachedBotsSection" style="display: none;">
            <div class="section-header">
                <h2>
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/>
                    </svg>
                    Attached Bots
                </h2>
                <span class="bots-count" id="botsCount">0 bots</span>
            </div>
            <div class="attached-bots-grid" id="attachedBotsGrid">
                <!-- Bot cards will be inserted here -->
            </div>
        </section>

        <!-- Quick Trade Section -->
        <section class="quick-trade-section" id="quickTradeSection">
            <div class="section-header">
                <h2>
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>
                    </svg>
                    Quick Trade
                </h2>
                <button class="add-quick-trade-btn" id="addQuickTradeBtn">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="12" y1="5" x2="12" y2="19"/>
                        <line x1="5" y1="12" x2="19" y2="12"/>
                    </svg>
                    Add Quick Trade
                </button>
            </div>
            <div class="quick-trade-grid" id="quickTradeGrid">
                <!-- Quick trade cards will be inserted here -->
            </div>
            <div class="loading-state" id="quickTradeLoading" style="display: none;">
                <div class="spinner"></div>
                <p>Loading quick trades...</p>
            </div>
            <div class="empty-quick-trades" id="emptyQuickTrades" style="display: none;">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                    <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>
                </svg>
                <p>No quick trades configured for this account</p>
                <button class="btn-secondary" id="addFirstQuickTradeBtn">Add Quick Trade</button>
            </div>
        </section>

        <!-- Open Positions & Orders Section -->
        <section class="positions-orders-section">
            <div class="section-header">
                <div class="section-tabs">
                    <button class="section-tab active" data-tab="positions">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/>
                        </svg>
                        Open Positions
                        <span class="tab-count" id="positionsCount">0</span>
                    </button>
                    <button class="section-tab" data-tab="orders">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                            <polyline points="14 2 14 8 20 8"/>
                            <line x1="16" y1="13" x2="8" y2="13"/>
                            <line x1="16" y1="17" x2="8" y2="17"/>
                        </svg>
                        Open Orders
                        <span class="tab-count" id="ordersCount">0</span>
                    </button>
                </div>
                <button class="refresh-btn" id="refreshPositionsBtn">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="23 4 23 10 17 10"/>
                        <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/>
                    </svg>
                    Refresh
                </button>
            </div>

            <!-- Positions Tab Content -->
            <div class="tab-content active" id="positionsTab">
                <div class="positions-container">
                    <div class="positions-table-wrapper">
                        <table class="positions-table" id="positionsTable">
                            <thead>
                                <tr>
                                    <th>Symbol</th>
                                    <th>Side</th>
                                    <th>Size ($)</th>
                                    <th>Entry Price</th>
                                    <th>Mark Price</th>
                                    <th>SL / TP</th>
                                    <th>Unrealized PnL</th>
                                    <th>Leverage</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="positionsBody">
                                <!-- Positions will be inserted here -->
                            </tbody>
                        </table>
                    </div>

                    <div class="loading-state" id="positionsLoading" style="display: none;">
                        <div class="spinner"></div>
                        <p>Loading positions...</p>
                    </div>

                    <div class="empty-positions" id="emptyPositions" style="display: none;">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <circle cx="12" cy="12" r="10"/>
                            <path d="M8 12h8"/>
                        </svg>
                        <p>No open positions</p>
                    </div>
                </div>
            </div>

            <!-- Orders Tab Content -->
            <div class="tab-content" id="ordersTab">
                <div class="orders-container">
                    <div class="orders-table-wrapper">
                        <table class="orders-table" id="ordersTable">
                            <thead>
                                <tr>
                                    <th>Time</th>
                                    <th>Symbol</th>
                                    <th>Type</th>
                                    <th>Side</th>
                                    <th>Quantity</th>
                                    <th>Price</th>
                                    <th>Stop Price</th>
                                    <th>Reduce Only</th>
                                    <th>Close Pos</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="ordersBody">
                                <!-- Orders will be inserted here -->
                            </tbody>
                        </table>
                    </div>

                    <div class="loading-state" id="ordersLoading" style="display: none;">
                        <div class="spinner"></div>
                        <p>Loading orders...</p>
                    </div>

                    <div class="empty-orders" id="emptyOrders" style="display: none;">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <circle cx="12" cy="12" r="10"/>
                            <path d="M8 12h8"/>
                        </svg>
                        <p>No open orders</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Trade History Section (Closed Positions) -->
        <section class="trades-section">
            <div class="section-header">
                <h2>
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/>
                        <polyline points="12 6 12 12 16 14"/>
                    </svg>
                    Trade History
                </h2>
                <div class="section-actions">
                    <button class="refresh-btn" id="refreshTradesBtn">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="23 4 23 10 17 10"/>
                            <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/>
                        </svg>
                        Refresh
                    </button>
                    <button class="action-btn sync-btn" id="syncTradesBtn">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="23 4 23 10 17 10"/>
                            <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/>
                        </svg>
                        <span>Sync Trades</span>
                    </button>
                </div>
            </div>

            <div class="trades-container">
                <div class="trades-table-wrapper">
                    <table class="trades-table" id="tradesTable">
                        <thead>
                            <tr>
                                <th>Closed</th>
                                <th>Symbol</th>
                                <th>Side</th>
                                <th>Size</th>
                                <th>Entry</th>
                                <th>Exit</th>
                                <th>PnL</th>
                                <th>Duration</th>
                                <th>Setup</th>
                            </tr>
                        </thead>
                        <tbody id="tradesBody">
                            <!-- Closed positions will be inserted here -->
                        </tbody>
                    </table>
                </div>

                <!-- Pagination Controls -->
                <div class="pagination-controls" id="tradesPagination" style="display: none;">
                    <button class="pagination-btn" id="prevPageBtn" disabled>
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="15 18 9 12 15 6"/>
                        </svg>
                        Previous
                    </button>
                    <span class="pagination-info" id="paginationInfo">Page 1 of 1</span>
                    <button class="pagination-btn" id="nextPageBtn">
                        Next
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="9 18 15 12 9 6"/>
                        </svg>
                    </button>
                </div>

                <div class="loading-state" id="tradesLoading" style="display: none;">
                    <div class="spinner"></div>
                    <p>Loading trade history...</p>
                </div>

                <div class="empty-trades" id="emptyTrades" style="display: none;">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                        <circle cx="12" cy="12" r="10"/>
                        <polyline points="12 6 12 12 16 14"/>
                    </svg>
                    <p>No closed positions yet</p>
                    <button class="btn-secondary" onclick="document.getElementById('syncBtn').click()">Sync Trades Now</button>
                </div>
            </div>
        </section>
        </main>
    </div>

    <!-- Close All Confirmation Modal -->
    <div class="modal-overlay" id="closeAllModal">
        <div class="modal modal-small">
            <div class="modal-header">
                <h3>Close All Positions</h3>
                <button class="modal-close" id="closeCloseAllModal">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="warning-icon danger">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
                        <line x1="12" y1="9" x2="12" y2="13"/>
                        <line x1="12" y1="17" x2="12.01" y2="17"/>
                    </svg>
                </div>
                <p><strong>Warning:</strong> This will close ALL open positions at market price.</p>
                <p class="warning-text">This action cannot be undone. Make sure you understand the implications.</p>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" id="cancelCloseAllBtn">Cancel</button>
                <button class="btn-danger" id="confirmCloseAllBtn">
                    <span class="btn-text">Close All Positions</span>
                    <span class="btn-loading" style="display: none;">
                        <div class="btn-spinner"></div>
                        Closing...
                    </span>
                </button>
            </div>
        </div>
    </div>

    <!-- Close Position Modal -->
    <div class="modal-overlay" id="closePositionModal">
        <div class="modal modal-small">
            <div class="modal-header">
                <h3>Close Position</h3>
                <button class="modal-close" id="closePositionModalBtn">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="position-info">
                    <span class="position-symbol" id="closePositionSymbol">BTCUSDT</span>
                    <span class="position-side" id="closePositionSide">LONG</span>
                </div>
                <div class="position-details">
                    <div class="detail-row">
                        <span>Current Size:</span>
                        <span id="closePositionSize">0.00</span>
                    </div>
                    <div class="detail-row">
                        <span>Unrealized PnL:</span>
                        <span id="closePositionPnl">$0.00</span>
                    </div>
                </div>
                <div class="close-amount-section">
                    <label>Close Amount</label>
                    <div class="percentage-buttons">
                        <button class="pct-btn" data-pct="25">25%</button>
                        <button class="pct-btn" data-pct="50">50%</button>
                        <button class="pct-btn" data-pct="75">75%</button>
                        <button class="pct-btn active" data-pct="100">100%</button>
                    </div>
                    <div class="slider-container">
                        <input type="range" id="closePercentSlider" min="1" max="100" value="100" class="percentage-slider">
                        <div class="slider-value"><span id="closePercentValue">100</span>%</div>
                    </div>
                    <div class="usdc-input-section">
                        <label for="closeUsdc">Or enter USDC amount:</label>
                        <input type="number" id="closeUsdc" step="any" placeholder="Enter USDC...">
                    </div>
                    <div class="close-quantity">
                        <span>Quantity to close:</span>
                        <span id="closeQuantityValue">0.00</span>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" id="cancelClosePositionBtn">Cancel</button>
                <button class="btn-danger" id="confirmClosePositionBtn">
                    <span class="btn-text">Close Position</span>
                    <span class="btn-loading" style="display: none;">
                        <div class="btn-spinner"></div>
                        Closing...
                    </span>
                </button>
            </div>
        </div>
    </div>

    <!-- Edit Stop Loss Modal -->
    <div class="modal-overlay" id="editStopLossModal">
        <div class="modal modal-small">
            <div class="modal-header">
                <h3>Edit Stop Loss</h3>
                <button class="modal-close" id="closeEditStopLossModal">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="position-info">
                    <span class="position-symbol" id="slSymbol">BTCUSDT</span>
                    <span class="position-side" id="slSide">LONG</span>
                </div>
                <div class="position-details">
                    <div class="detail-row">
                        <span>Entry Price:</span>
                        <span id="slEntryPrice">$0.00</span>
                    </div>
                    <div class="detail-row">
                        <span>Mark Price:</span>
                        <span id="slMarkPrice">$0.00</span>
                    </div>
                    <div class="detail-row">
                        <span>Position Size:</span>
                        <span id="slQuantity">0.00</span>
                    </div>
                    <div class="detail-row">
                        <span>Current Stop Loss:</span>
                        <span id="slCurrentStop">None</span>
                    </div>
                </div>
                <div class="form-group">
                    <label for="newStopPrice">New Stop Loss Price</label>
                    <input type="number" id="newStopPrice" step="0.01" placeholder="Enter stop price...">
                    <div class="stop-loss-hint" id="slHint">
                        <!-- Hint will be shown here -->
                    </div>
                </div>
                <div class="potential-loss-display" id="slPotentialLossSection" style="display: none;">
                    <div class="detail-row loss-row">
                        <span>Potential Loss:</span>
                        <span id="slPotentialLoss" class="loss-amount">$0.00</span>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" id="cancelEditStopLossBtn">Cancel</button>
                <button class="btn-secondary" id="removeStopLossBtn" style="display: none;">
                    Remove SL
                </button>
                <button class="btn-primary" id="confirmEditStopLossBtn">
                    <span class="btn-text">Set Stop Loss</span>
                    <span class="btn-loading" style="display: none;">
                        <div class="btn-spinner"></div>
                        Updating...
                    </span>
                </button>
            </div>
        </div>
    </div>

    <!-- Edit Take Profit Modal -->
    <div class="modal-overlay" id="editTakeProfitModal">
        <div class="modal modal-small">
            <div class="modal-header">
                <h3>Edit Take Profit</h3>
                <button class="modal-close" id="closeEditTakeProfitModal">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="position-info">
                    <span class="position-symbol" id="tpSymbol">BTCUSDT</span>
                    <span class="position-side" id="tpSide">LONG</span>
                </div>
                <div class="position-details">
                    <div class="detail-row">
                        <span>Entry Price:</span>
                        <span id="tpEntryPrice">$0.00</span>
                    </div>
                    <div class="detail-row">
                        <span>Mark Price:</span>
                        <span id="tpMarkPrice">$0.00</span>
                    </div>
                    <div class="detail-row">
                        <span>Current Take Profit:</span>
                        <span id="tpCurrentTP">None</span>
                    </div>
                </div>
                <div class="form-group">
                    <label for="newTakeProfitPrice">New Take Profit Price</label>
                    <input type="number" id="newTakeProfitPrice" step="0.01" placeholder="Enter take profit price...">
                    <div class="take-profit-hint" id="tpHint">
                        <!-- Hint will be shown here -->
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" id="cancelEditTakeProfitBtn">Cancel</button>
                <button class="btn-secondary" id="removeTakeProfitBtn" style="display: none;">
                    Remove TP
                </button>
                <button class="btn-primary" id="confirmEditTakeProfitBtn">
                    <span class="btn-text">Set Take Profit</span>
                    <span class="btn-loading" style="display: none;">
                        <div class="btn-spinner"></div>
                        Updating...
                    </span>
                </button>
            </div>
        </div>
    </div>

    <!-- Add to Position Modal -->
    <div class="modal-overlay" id="addToPositionModal">
        <div class="modal modal-small">
            <div class="modal-header">
                <h3>Add to Position</h3>
                <button class="modal-close" id="closeAddToPositionModal">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="position-info">
                    <span class="position-symbol" id="addPosSymbol">BTCUSDT</span>
                    <span class="position-side" id="addPosSide">LONG</span>
                </div>
                <div class="position-details">
                    <div class="detail-row">
                        <span>Current Size:</span>
                        <span id="addPosCurrentSize">0.00</span>
                    </div>
                    <div class="detail-row">
                        <span>Entry Price:</span>
                        <span id="addPosEntryPrice">$0.00</span>
                    </div>
                    <div class="detail-row">
                        <span>Mark Price:</span>
                        <span id="addPosMarkPrice">$0.00</span>
                    </div>
                    <div class="detail-row">
                        <span>Leverage:</span>
                        <span id="addPosLeverage">1x</span>
                    </div>
                </div>
                <div class="available-margin-info">
                    <div class="margin-row">
                        <span>Available Balance:</span>
                        <span id="addPosAvailBalance">$0.00</span>
                    </div>
                    <div class="margin-row highlight">
                        <span>Max You Can Add:</span>
                        <span id="addPosMaxAdd">$0.00</span>
                    </div>
                </div>
                <div class="form-group">
                    <label for="addPosUsdc">Size to Add (USDC)</label>
                    <input type="number" id="addPosUsdc" step="any" placeholder="Enter USDC amount...">
                    <div class="add-pos-quick-btns">
                        <button type="button" class="quick-btn" data-pct="25">25%</button>
                        <button type="button" class="quick-btn" data-pct="50">50%</button>
                        <button type="button" class="quick-btn" data-pct="75">75%</button>
                        <button type="button" class="quick-btn" data-pct="100">Max</button>
                    </div>
                    <div class="calculated-qty">
                        Quantity: <span id="addPosCalcQty">0.00</span>
                    </div>
                    <div class="add-pos-hint">
                        This will place a market order to increase your position size
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" id="cancelAddToPositionBtn">Cancel</button>
                <button class="btn-primary" id="confirmAddToPositionBtn">
                    <span class="btn-text">Add to Position</span>
                    <span class="btn-loading" style="display: none;">
                        <div class="btn-spinner"></div>
                        Adding...
                    </span>
                </button>
            </div>
        </div>
    </div>

    <!-- Sync Options Modal -->
    <div class="modal-overlay" id="syncOptionsModal">
        <div class="modal modal-small">
            <div class="modal-header">
                <h3>Sync Trades</h3>
                <button class="modal-close" id="closeSyncOptionsModal">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="sync-options-info">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/>
                        <line x1="12" y1="16" x2="12" y2="12"/>
                        <line x1="12" y1="8" x2="12.01" y2="8"/>
                    </svg>
                    <p>Binance API provides up to 6 months of trade history. Select how many weeks to fetch.</p>
                </div>
                <div class="form-group">
                    <label for="syncWeeks">Weeks to Fetch</label>
                    <select id="syncWeeks" class="form-select">
                        <option value="1" selected>1 week (default)</option>
                        <option value="2">2 weeks</option>
                        <option value="4">4 weeks (1 month)</option>
                        <option value="8">8 weeks (2 months)</option>
                        <option value="12">12 weeks (3 months)</option>
                        <option value="26">26 weeks (6 months - max)</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" id="cancelSyncBtn">Cancel</button>
                <button class="btn-primary" id="startSyncBtn">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="23 4 23 10 17 10"/>
                        <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/>
                    </svg>
                    Start Sync
                </button>
            </div>
        </div>
    </div>

    <!-- Sync Progress Modal -->
    <div class="modal-overlay" id="syncModal">
        <div class="modal modal-small">
            <div class="modal-body sync-progress">
                <div class="sync-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="23 4 23 10 17 10"/>
                        <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/>
                    </svg>
                </div>
                <h3>Syncing Trades</h3>
                <p id="syncStatus">Fetching trades from Binance...</p>
                <p id="syncWeekProgress" class="sync-week-info"></p>
                <div class="progress-bar">
                    <div class="progress-fill" id="syncProgress"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- New Trade Modal -->
    <div class="modal-overlay" id="newTradeModal">
        <div class="modal trade-modal">
            <div class="modal-header">
                <h3>New Trade</h3>
                <button class="modal-close" id="closeTradeModal">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>
            <!-- Trade Modal Tabs -->
            <div class="trade-modal-tabs">
                <button class="trade-modal-tab active" data-tab="manual">Manual</button>
                <button class="trade-modal-tab" data-tab="risk-calc">Risk Calculator</button>
            </div>
            <div class="modal-body trade-modal-body">
                <!-- Manual Trade Tab -->
                <div class="trade-tab-content active" id="manualTradeTab">
                <!-- Symbol Selector -->
                <div class="trade-symbol-selector">
                    <label>Symbol</label>  
                    <div class="symbol-search-container">
                        <input type="text" id="symbolSearch" class="symbol-search-input" placeholder="Search symbol..." autocomplete="off">
                        <select id="tradeSymbol" class="trade-select">
                            <option value="BTCUSDT">BTC/USDT</option>
                            <option value="BTCUSDC">BTC/USDC</option>
                            <option value="ETHUSDT">ETH/USDT</option>
                            <option value="ETHUSDC">ETH/USDC</option>
                            <option value="SOLUSDT">SOL/USDT</option>
                            <option value="SOLUSDC">SOL/USDC</option>
                            <option value="AAVEUSDT">AAVE/USDT</option>
                            <option value="AAVEUSDC">AAVE/USDC</option>
                        </select>
                    </div>
                </div>

                <!-- Margin & Leverage Row -->
                <div class="trade-settings-row">
                    <div class="trade-toggle-group">
                        <button class="trade-toggle" data-margin="CROSSED" id="marginCross">Cross</button>
                        <button class="trade-toggle active" data-margin="ISOLATED" id="marginIsolated">Isolated</button>
                    </div>
                    <div class="leverage-selector">
                        <button class="leverage-btn" id="leverageBtn">
                            <span id="leverageValue">5</span>x
                        </button>
                    </div>
                </div>

                <!-- Order Type Tabs -->
                <div class="trade-order-tabs">
                    <button class="order-tab active" data-type="LIMIT">Limit</button>
                    <button class="order-tab" data-type="MARKET">Market</button>
                    <button class="order-tab" data-type="STOP">Stop Limit</button>
                </div>

                <!-- Price Input (for Limit/Stop orders) -->
                <div class="trade-input-group" id="priceInputGroup">
                    <label>Price</label>
                    <div class="trade-input-wrapper">
                        <input type="number" id="tradePrice" placeholder="0.00" step="0.01">
                        <span class="input-suffix">USDC</span>
                    </div>
                </div>

                <!-- Stop Price Input (for Stop Limit orders) -->
                <div class="trade-input-group" id="stopPriceInputGroup" style="display: none;">
                    <label>Stop Price</label>
                    <div class="trade-input-wrapper">
                        <input type="number" id="tradeStopPrice" placeholder="0.00" step="0.01">
                        <span class="input-suffix">USDC</span>
                    </div>
                </div>

                <!-- Size Input -->
                <div class="trade-input-group">
                    <label>Size</label>
                    <div class="trade-input-wrapper">
                        <input type="number" id="tradeSize" placeholder="0.00" step="0.001">
                        <span class="input-suffix">USDC</span>
                    </div>
                </div>

                <!-- Size Percentage Slider -->
                <div class="trade-slider-group">
                    <input type="range" id="tradeSizeSlider" min="0" max="100" value="0" step="25">
                    <div class="slider-labels">
                        <span data-value="0">0%</span>
                        <span data-value="25">25%</span>
                        <span data-value="50">50%</span>
                        <span data-value="75">75%</span>
                        <span data-value="100">100%</span>
                    </div>
                </div>

                <!-- Options Row -->
                <div class="trade-options-row">
                    <label class="trade-checkbox">
                        <input type="checkbox" id="tradeTpSl">
                        <span class="checkmark"></span>
                        TP/SL
                    </label>
                    <label class="trade-checkbox">
                        <input type="checkbox" id="tradeReduceOnly">
                        <span class="checkmark"></span>
                        Reduce-Only
                    </label>
                    <div class="tif-selector">
                        <span class="tif-label">TIF</span>
                        <select id="tradeTif" class="tif-select">
                            <option value="GTC">GTC</option>
                            <option value="IOC">IOC</option>
                            <option value="FOK">FOK</option>
                        </select>
                    </div>
                </div>

                <!-- TP/SL Inputs (hidden by default) -->
                <div class="trade-tpsl-group" id="tradeTpSlGroup" style="display: none;">
                    <div class="trade-input-group">
                        <label>Take Profit</label>
                        <div class="trade-input-wrapper">
                            <input type="number" id="tradeTpPrice" placeholder="0.00" step="0.01">
                            <span class="input-suffix">USDC</span>
                        </div>
                    </div>
                    <div class="trade-input-group">
                        <label>Stop Loss</label>
                        <div class="trade-input-wrapper">
                            <input type="number" id="tradeSlPrice" placeholder="0.00" step="0.01">
                            <span class="input-suffix">USDC</span>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="trade-buttons">
                    <button class="trade-btn-long" id="tradeBuyBtn">
                        <span class="btn-text">Buy/Long</span>
                        <span class="btn-loading" style="display: none;">
                            <svg class="spinner-icon" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="3" fill="none" stroke-dasharray="31.4 31.4" stroke-linecap="round"><animateTransform attributeName="transform" type="rotate" from="0 12 12" to="360 12 12" dur="1s" repeatCount="indefinite"/></circle></svg>
                        </span>
                    </button>
                    <button class="trade-btn-short" id="tradeSellBtn">
                        <span class="btn-text">Sell/Short</span>
                        <span class="btn-loading" style="display: none;">
                            <svg class="spinner-icon" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="3" fill="none" stroke-dasharray="31.4 31.4" stroke-linecap="round"><animateTransform attributeName="transform" type="rotate" from="0 12 12" to="360 12 12" dur="1s" repeatCount="indefinite"/></circle></svg>
                        </span>
                    </button>
                </div>

                <!-- Trade Info -->
                <div class="trade-info-row">
                    <div class="trade-info-item">
                        <span class="info-label">Available</span>
                        <span class="info-value" id="tradeAvailable">0.00 USDC</span>
                    </div>
                    <div class="trade-info-item">
                        <span class="info-label">Max Position</span>
                        <span class="info-value highlight" id="tradeMax">0.00 USDC</span>
                    </div>
                    <div class="trade-info-item">
                        <span class="info-label">Cost</span>
                        <span class="info-value" id="tradeCost">0.00 USDC</span>
                    </div>
                </div>
                </div><!-- End Manual Trade Tab -->

                <!-- Risk Calculator Tab -->
                <div class="trade-tab-content" id="riskCalcTab">
                    <!-- Symbol Input -->
                    <div class="trade-input-group">
                        <label>Symbol</label>
                        <div class="trade-input-wrapper">
                            <input type="text" id="riskSymbolInput" placeholder="e.g. BTCUSDC, DOGEUSDT" value="BTCUSDC" autocomplete="off">
                        </div>
                    </div>

                    <!-- Current Price Display -->
                    <div class="risk-current-price">
                        <span class="price-label">Current Price:</span>
                        <span class="price-value" id="riskCurrentPrice">--</span>
                        <button class="refresh-price-btn" id="refreshPriceBtn" title="Refresh price">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14">
                                <polyline points="23 4 23 10 17 10"/>
                                <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/>
                            </svg>
                        </button>
                    </div>

                    <!-- Margin & Leverage Row -->
                    <div class="trade-settings-row">
                        <div class="trade-toggle-group">
                            <button class="trade-toggle" data-margin="CROSSED" id="riskMarginCross">Cross</button>
                            <button class="trade-toggle active" data-margin="ISOLATED" id="riskMarginIsolated">Isolated</button>
                        </div>
                        <div class="leverage-selector">
                            <button class="leverage-btn" id="riskLeverageBtn">
                                <span id="riskLeverageValue">20</span>x
                            </button>
                        </div>
                    </div>

                    <!-- Order Type Selection -->
                    <div class="risk-order-type">
                        <label>Order Type</label>
                        <div class="risk-order-toggle">
                            <button class="risk-order-btn active" data-type="MARKET" id="riskOrderMarket">Market</button>
                            <button class="risk-order-btn" data-type="BBO" id="riskOrderBBO">BBO Limit</button>
                        </div>
                    </div>

                    <!-- Risk Parameters -->
                    <div class="trade-input-group">
                        <label>Stop Loss Price</label>
                        <div class="trade-input-wrapper">
                            <input type="number" id="riskSlPrice" placeholder="0.00" step="any">
                            <span class="input-suffix" id="riskSlSuffix">USDC</span>
                        </div>
                    </div>
                    <div class="trade-input-group">
                        <label>Risk %</label>
                        <div class="trade-input-wrapper">
                            <input type="number" id="riskPercent" placeholder="5.0" step="0.1" value="5.0">
                            <span class="input-suffix">%</span>
                        </div>
                    </div>

                    <!-- Real-time Calculations Display -->
                    <div class="risk-calculations">
                        <div class="calc-header">Position Calculator</div>
                        <div class="calc-row">
                            <span class="calc-label">Account Balance:</span>
                            <span class="calc-value" id="riskAccountBalance">$0.00</span>
                        </div>
                        <div class="calc-row">
                            <span class="calc-label">Risk Amount:</span>
                            <span class="calc-value highlight" id="riskAmount">$0.00</span>
                        </div>
                        <div class="calc-row">
                            <span class="calc-label">SL Distance:</span>
                            <span class="calc-value" id="riskSlDistance">0.00%</span>
                        </div>
                        <div class="calc-row">
                            <span class="calc-label">Position Size:</span>
                            <span class="calc-value highlight large" id="riskPositionSize">$0.00</span>
                        </div>
                        <div class="calc-row">
                            <span class="calc-label">Quantity:</span>
                            <span class="calc-value" id="riskQuantity">0.0000</span>
                        </div>
                        <div class="calc-row">
                            <span class="calc-label">Margin Required:</span>
                            <span class="calc-value" id="riskMarginRequired">$0.00</span>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="trade-buttons">
                        <button class="trade-btn-long" id="riskBuyBtn">
                            <span class="btn-text">Buy/Long</span>
                            <span class="btn-loading" style="display: none;">
                                <svg class="spinner-icon" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="3" fill="none" stroke-dasharray="31.4 31.4" stroke-linecap="round"><animateTransform attributeName="transform" type="rotate" from="0 12 12" to="360 12 12" dur="1s" repeatCount="indefinite"/></circle></svg>
                            </span>
                        </button>
                        <button class="trade-btn-short" id="riskSellBtn">
                            <span class="btn-text">Sell/Short</span>
                            <span class="btn-loading" style="display: none;">
                                <svg class="spinner-icon" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="3" fill="none" stroke-dasharray="31.4 31.4" stroke-linecap="round"><animateTransform attributeName="transform" type="rotate" from="0 12 12" to="360 12 12" dur="1s" repeatCount="indefinite"/></circle></svg>
                            </span>
                        </button>
                    </div>

                    <!-- Trade Info -->
                    <div class="trade-info-row">
                        <div class="trade-info-item">
                            <span class="info-label">Available</span>
                            <span class="info-value" id="riskTradeAvailable">0.00 USDC</span>
                        </div>
                        <div class="trade-info-item">
                            <span class="info-label">Max Position</span>
                            <span class="info-value highlight" id="riskTradeMax">0.00 USDC</span>
                        </div>
                    </div>
                </div><!-- End Risk Calculator Tab -->
            </div>
        </div>
    </div>

    <!-- Leverage Slider Modal -->
    <div class="modal-overlay" id="leverageModal">
        <div class="modal modal-small leverage-modal">
            <div class="modal-header">
                <h3>Adjust Leverage</h3>
                <button class="modal-close" id="closeLeverageModal">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="leverage-display">
                    <span id="leverageDisplayValue">5</span>x
                </div>
                <input type="range" id="leverageSlider" min="1" max="125" value="5" class="leverage-slider">
                <div class="leverage-labels">
                    <span>1x</span>
                    <span>25x</span>
                    <span>50x</span>
                    <span>75x</span>
                    <span>100x</span>
                    <span>125x</span>
                </div>
                <div class="leverage-warning">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
                        <line x1="12" y1="9" x2="12" y2="13"/>
                        <line x1="12" y1="17" x2="12.01" y2="17"/>
                    </svg>
                    <span>Higher leverage = Higher risk of liquidation</span>
                </div>
                <button class="btn-primary" id="confirmLeverageBtn">Confirm</button>
            </div>
        </div>
    </div>

    <!-- Link to Setup Modal -->
    <div class="modal-overlay" id="linkSetupModal">
        <div class="modal modal-small">
            <div class="modal-header">
                <h3>Link to Setup</h3>
                <button class="modal-close" id="closeLinkSetupModal">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="trade-link-info" id="tradeLinkInfo">
                    <!-- Trade info will be inserted here -->
                </div>
                <div class="form-group">
                    <label for="setupSelect">Select Setup</label>
                    <select id="setupSelect">
                        <option value="">-- Select a setup --</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" id="cancelLinkSetup">Cancel</button>
                <button class="btn-primary" id="confirmLinkSetup">Link Setup</button>
            </div>
        </div>
    </div>

    <!-- Trade Journal Modal -->
    <div class="modal-overlay" id="journalModal">
        <div class="modal journal-modal">
            <div class="modal-header">
                <h3>Trade Journal</h3>
                <button class="modal-close" id="closeJournalModal">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <!-- Trade Summary -->
                <div class="journal-trade-summary">
                    <div class="trade-summary-row">
                        <span class="journal-symbol" id="journalSymbol">BTCUSDT</span>
                        <span class="journal-side" id="journalSide">LONG</span>
                        <span class="journal-pnl" id="journalPnl">+$0.00</span>
                    </div>
                    <div class="trade-summary-details">
                        <span id="journalDate">Dec 20, 2024</span>
                        <span id="journalSize">$0.00</span>
                    </div>
                </div>

                <!-- Rating -->
                <div class="journal-section">
                    <label>Trade Rating</label>
                    <div class="star-rating" id="journalRating">
                        <button class="star-btn" data-rating="1">&#9733;</button>
                        <button class="star-btn" data-rating="2">&#9733;</button>
                        <button class="star-btn" data-rating="3">&#9733;</button>
                        <button class="star-btn" data-rating="4">&#9733;</button>
                        <button class="star-btn" data-rating="5">&#9733;</button>
                    </div>
                </div>

                <!-- Emotions -->
                <div class="journal-section">
                    <label>Emotions</label>
                    <div class="tag-selector" id="emotionTags">
                        <button class="tag-btn" data-tag="Confident">Confident</button>
                        <button class="tag-btn" data-tag="Calm">Calm</button>
                        <button class="tag-btn" data-tag="Anxious">Anxious</button>
                        <button class="tag-btn" data-tag="FOMO">FOMO</button>
                        <button class="tag-btn" data-tag="Revenge">Revenge</button>
                        <button class="tag-btn" data-tag="Greedy">Greedy</button>
                        <button class="tag-btn" data-tag="Fearful">Fearful</button>
                    </div>
                </div>

                <!-- Mistakes -->
                <div class="journal-section">
                    <label>Mistakes</label>
                    <div class="tag-selector" id="mistakeTags">
                        <button class="tag-btn" data-tag="No stop loss">No stop loss</button>
                        <button class="tag-btn" data-tag="Moved stop">Moved stop</button>
                        <button class="tag-btn" data-tag="Oversize">Oversize</button>
                        <button class="tag-btn" data-tag="Chased entry">Chased entry</button>
                        <button class="tag-btn" data-tag="Early exit">Early exit</button>
                        <button class="tag-btn" data-tag="Late exit">Late exit</button>
                        <button class="tag-btn" data-tag="Against trend">Against trend</button>
                    </div>
                </div>

                <!-- Notes -->
                <div class="journal-section">
                    <label for="journalNotes">Notes</label>
                    <textarea id="journalNotes" rows="4" placeholder="What did you learn from this trade?"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" id="cancelJournalBtn">Cancel</button>
                <button class="btn-primary" id="saveJournalBtn">
                    <span class="btn-text">Save Journal</span>
                    <span class="btn-loading" style="display: none;">
                        <span class="btn-spinner"></span>
                        Saving...
                    </span>
                </button>
            </div>
        </div>
    </div>

    <!-- Add/Edit Quick Trade Modal -->
    <div class="modal-overlay" id="quickTradeModal">
        <div class="modal">
            <div class="modal-header">
                <h3 id="quickTradeModalTitle">Add Quick Trade</h3>
                <button class="modal-close" id="closeQuickTradeModal">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="qtName">Name</label>
                    <input type="text" id="qtName" placeholder="e.g., BTC 7/19 EMA">
                </div>
                <div class="form-group">
                    <label for="qtSymbol">Symbol</label>
                    <input type="text" id="qtSymbol" value="BTCUSDC" placeholder="e.g., BTCUSDC, ETHUSDC">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="qtFastEma">Fast EMA</label>
                        <input type="number" id="qtFastEma" value="7" min="1">
                    </div>
                    <div class="form-group">
                        <label for="qtSlowEma">Slow EMA</label>
                        <input type="number" id="qtSlowEma" value="19" min="1">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="qtRiskPercent">Risk %</label>
                        <input type="number" id="qtRiskPercent" value="1.3" step="0.1" min="0.1" max="100">
                    </div>
                    <div class="form-group">
                        <label for="qtLeverage">Leverage</label>
                        <input type="number" id="qtLeverage" value="5" min="1" max="125">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="qtSlLookback">SL Candles</label>
                        <input type="number" id="qtSlLookback" value="4" min="1" max="20">
                    </div>
                    <div class="form-group">
                        <label for="qtTimeframe">Timeframe</label>
                        <select id="qtTimeframe" class="form-select">
                            <option value="5m">5m</option>
                            <option value="15m">15m</option>
                            <option value="30m" selected>30m</option>
                            <option value="1h">1h</option>
                            <option value="4h">4h</option>
                            <option value="1d">1d</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="qtSlMinPercent">SL Min %</label>
                        <input type="number" id="qtSlMinPercent" value="0.25" step="0.01" min="0">
                    </div>
                    <div class="form-group">
                        <label for="qtSlMaxPercent">SL Max %</label>
                        <input type="number" id="qtSlMaxPercent" value="1.81" step="0.01" min="0">
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" id="cancelQuickTradeBtn">Cancel</button>
                <button class="btn-primary" id="saveQuickTradeBtn">Save</button>
            </div>
        </div>
    </div>

    <!-- Quick Trade Confirmation Modal -->
    <div class="modal-overlay" id="qtTradeConfirmModal">
        <div class="modal modal-small">
            <div class="modal-header">
                <h3 id="qtTradeConfirmTitle">Confirm Trade</h3>
                <button class="modal-close" id="closeQtTradeConfirmModal">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="trade-confirm-details">
                    <div class="trade-detail-row">
                        <span class="label">Order Type:</span>
                        <span id="qtConfirmOrderType" class="order-type-badge"></span>
                    </div>
                    <div class="trade-detail-row">
                        <span class="label">Direction:</span>
                        <span id="qtConfirmDirection" class="direction-badge"></span>
                    </div>
                    <div class="trade-detail-row">
                        <span class="label">Symbol:</span>
                        <span id="qtConfirmSymbol"></span>
                    </div>
                    <div class="trade-detail-row">
                        <span class="label">Entry Price:</span>
                        <span id="qtConfirmEntry"></span>
                    </div>
                    <div class="trade-detail-row">
                        <span class="label">Stop Loss:</span>
                        <span id="qtConfirmSL"></span>
                    </div>
                    <div class="trade-detail-row">
                        <span class="label">SL Distance:</span>
                        <span id="qtConfirmSLPercent"></span>
                    </div>
                    <div class="trade-detail-row">
                        <span class="label">Position Size:</span>
                        <span id="qtConfirmSize"></span>
                    </div>
                    <div class="trade-detail-row">
                        <span class="label">Risk Amount:</span>
                        <span id="qtConfirmRisk"></span>
                    </div>
                </div>
                <div class="trade-warning">
                    This will execute a real trade on your account.
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" id="cancelQtTradeBtn">Cancel</button>
                <button class="btn-primary" id="executeQtTradeBtn">Execute Trade</button>
            </div>
        </div>
    </div>

    <!-- Quick Trade Limit Price Modal -->
    <div class="modal-overlay" id="qtLimitPriceModal">
        <div class="modal modal-small">
            <div class="modal-header">
                <h3 id="qtLimitPriceModalTitle">Enter Limit Price</h3>
                <button class="modal-close" id="closeQtLimitPriceModal">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="current-price-display">
                    <span class="label">Current Price:</span>
                    <span id="qtLimitModalCurrentPrice" class="value">--</span>
                </div>
                <div class="form-group">
                    <label for="qtLimitPriceInput">Limit Price</label>
                    <input type="number" id="qtLimitPriceInput" step="any" placeholder="Enter limit price">
                </div>
                <div class="limit-calc-preview" id="qtLimitCalcPreview">
                    <!-- Will show recalculated SL% and position size -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" id="cancelQtLimitPriceBtn">Cancel</button>
                <button class="btn-primary" id="confirmQtLimitPriceBtn">Continue</button>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <script>
        // Pass account ID to JavaScript
        const ACCOUNT_ID = {{ account_id }};
    </script>
    <script src="/static/accounts.js"></script>
    <script>
        // User dropdown toggle
        const userAvatarBtn = document.getElementById('userAvatarBtn');
        const userDropdown = document.getElementById('userDropdown');

        if (userAvatarBtn && userDropdown) {
            userAvatarBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                userDropdown.classList.toggle('active');
            });

            document.addEventListener('click', (e) => {
                if (!userDropdown.contains(e.target) && !userAvatarBtn.contains(e.target)) {
                    userDropdown.classList.remove('active');
                }
            });
        }

        // Mobile menu toggle
        const mobileMenuBtn = document.getElementById('mobileMenuBtn');
        const sidebar = document.querySelector('.sidebar');
        const mobileOverlay = document.getElementById('mobileOverlay');

        if (mobileMenuBtn && sidebar && mobileOverlay) {
            mobileMenuBtn.addEventListener('click', () => {
                sidebar.classList.toggle('open');
                mobileOverlay.classList.toggle('active');
            });

            mobileOverlay.addEventListener('click', () => {
                sidebar.classList.remove('open');
                mobileOverlay.classList.remove('active');
            });
        }
    </script>
</body>
</html>

